# use this file with:
# export TMPDIR="/scratch/$(whoami)/cache"
# export APPTAINER_TMPDIR="/scratch/$(whoami)/cache"
# export APPTAINER_CACHEDIR="/scratch/$(whoami)/cache"
# apptainer build env.sif env.def
# apptainer run --nv env.sif python3 ...

# troubleshoot with:
# apptainer exec env.sif sh
# cd /

Bootstrap: docker
From: python:3.12.11-bullseye

%files
    pyproject.toml /src/
    fms_ehrs /src/
    uv.lock /src/

%post
    cd /src
    python -m venv /opt/venv
    . /opt/venv/bin/activate
    /opt/venv/bin/pip install --no-cache-dir uv
    uv sync --active --link-mode=copy

%environment
    export PATH=/opt/venv/bin:$PATH
    export PYTHONPATH=/src:$PYTHONPATH
